{
  "name": "FP2 Auto-Token Configuration Template",
  "description": "Template configuration for Aqara FP2 auto-token refresh system",
  "version": "1.0.0",
  
  "credentials": {
    "aqara_username": "your_email@example.com",
    "aqara_password": "your_password",
    "aqara_area": "EU",
    "aqara_subjectId": "lumi1.XXXXXXXXXXXX",
    "aqara_timezone": "en-UK"
  },
  
  "area_codes": {
    "description": "Valid Aqara server regions",
    "options": {
      "EU": "Europe (Germany) - rpc-ger.aqara.com",
      "US": "United States - aiot-rpc-usa.aqara.com", 
      "CN": "China - aiot-rpc.aqara.cn",
      "RU": "Russia - rpc-ru.aqara.com",
      "KR": "South Korea - rpc-kr.aqara.com",
      "JP": "Japan - rpc-kr.aqara.com",
      "AF": "Africa - rpc-ger.aqara.com",
      "AU": "Australia - rpc-au.aqara.com",
      "ME": "Middle East - rpc-au.aqara.com",
      "HMT": "Hong Kong/Macau/Taiwan - aiot-rpc-usa.aqara.com",
      "OTHER": "Other regions - aiot-rpc-usa.aqara.com"
    }
  },
  
  "timezone_codes": {
    "description": "Valid timezone/country codes for Aqara API",
    "options": [
      "en-US", "en-UK", "es-ES", "de-DE", "it-IT", "pt-PT", 
      "fr-FR", "nl-NL", "pl-PL", "ru-RU", "zh-CN", "ja-JP", "ko-KR"
    ]
  },
  
  "device_id_format": {
    "description": "FP2 device ID format",
    "format": "lumi1.XXXXXXXXXXXX",
    "example": "lumi1.54ef4410041c",
    "note": "This is typically the MAC address of your FP2 device with 'lumi1.' prefix"
  },
  
  "global_variables": {
    "description": "Global variables created by the token management system",
    "variables": {
      "token": "Current Aqara API token (auto-refreshed)",
      "appid": "Aqara application ID", 
      "aqara_url": "Aqara server URL (without https://)",
      "subjectId": "Your FP2 device ID",
      "userid": "Your Aqara user ID",
      "country": "Your timezone/country code",
      "token_last_refresh": "Timestamp of last token refresh"
    }
  },
  
  "refresh_schedule": {
    "description": "Token refresh timing configuration",
    "auto_check_interval": "21600 seconds (6 hours)",
    "token_validity": "23 hours (refreshed before 24h expiry)",
    "startup_delay": "30 seconds after Node-RED starts",
    "timeout": "60 seconds for token generation"
  },
  
  "home_assistant_entities": {
    "description": "Home Assistant entities created by the system",
    "entities": {
      "sensor.fp2_token_status": {
        "name": "FP2 Token Status",
        "states": ["Connected", "Error"],
        "attributes": {
          "last_refresh": "ISO timestamp of last token refresh",
          "server": "Aqara server URL",
          "subject_id": "FP2 device ID", 
          "token_preview": "First 10 characters of current token"
        }
      }
    }
  },
  
  "troubleshooting": {
    "common_issues": {
      "invalid_credentials": {
        "symptoms": ["Login Failed!", "Authentication error"],
        "solutions": ["Verify username/password", "Check area code", "Ensure account is active"]
      },
      "missing_dependencies": {
        "symptoms": ["ImportError", "ModuleNotFoundError"],
        "solutions": ["Run: python3 -m pip install pycryptodome requests requests-toolbelt"]
      },
      "token_parse_failed": {
        "symptoms": ["Failed to parse token response"],
        "solutions": ["Check debug output", "Verify script downloaded correctly", "Try manual refresh"]
      },
      "device_not_found": {
        "symptoms": ["No devices listed", "Empty device array"],
        "solutions": ["Verify device is online", "Check Aqara app", "Confirm device ownership"]
      }
    }
  },
  
  "file_locations": {
    "description": "File paths used by the system",
    "temporary_files": {
      "/tmp/token_generator.py": "Downloaded Aqara token generator script",
      "/tmp/AqaraPOST-tokenGenerator.py": "Official token generator (temporary)"
    },
    "project_files": {
      "Aqara_FP2_TokenRefresh_nodered.json": "Main token management flow",
      "fp2_token_generator.py": "Enhanced Python token generator",
      "FP2_SETUP_INSTRUCTIONS.md": "Setup guide",
      "fp2_config_template.json": "This configuration template"
    }
  },
  
  "example_configurations": {
    "europe_user": {
      "aqara_username": "john@example.com",
      "aqara_password": "secretpassword123",
      "aqara_area": "EU",
      "aqara_subjectId": "lumi1.54ef4410041c",
      "aqara_timezone": "en-UK"
    },
    "us_user": {
      "aqara_username": "mary@example.com", 
      "aqara_password": "mypassword456",
      "aqara_area": "US",
      "aqara_subjectId": "lumi1.a1b2c3d4e5f6",
      "aqara_timezone": "en-US"
    },
    "italy_user": {
      "aqara_username": "giuseppe@example.it",
      "aqara_password": "lamiapwd789",
      "aqara_area": "EU", 
      "aqara_subjectId": "lumi1.123456789abc",
      "aqara_timezone": "it-IT"
    }
  },
  
  "node_red_flow_structure": {
    "description": "Overview of the Node-RED flow components",
    "main_nodes": {
      "aqara_config_node": "Sets global credentials and configuration",
      "download_token_script": "Downloads official Aqara token generator",
      "install_dependencies": "Installs required Python packages",
      "generate_token": "Executes token generation with credentials",
      "parse_token_output": "Parses and stores token data globally",
      "check_token_age": "Determines if tokens need refresh",
      "token_status_output": "Creates Home Assistant sensor entity"
    },
    "inject_nodes": {
      "auto_refresh_inject": "Triggers automatic refresh every 6 hours",
      "manual_refresh_inject": "Manual refresh button",
      "startup_refresh_inject": "Refresh on Node-RED startup"
    },
    "debug_nodes": {
      "token_debug_output": "Shows token generation results",
      "script_download_error": "Shows script download errors",
      "dependency_error": "Shows Python dependency errors", 
      "token_generation_error": "Shows token generation errors"
    }
  }
}